<!DOCTYPE html>
<!-- saved from url=(0071)https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session -->
<html lang="en" class="mdl-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Predicting Visitor Purchases with a Classification Model with BigQuery ML | Qwiklabs</title>
<script type="text/javascript" id="www-widgetapi-script" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/www-widgetapi.js.download" async=""></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/js"></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/iframe_api"></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/js(1)"></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/recaptcha__en.js.download" crossorigin="anonymous" integrity="sha384-f1gfYQgq4OmhARgCSe1q7WV7tIcPpqu0qD+jYdSEMczD1YXPg0ibdIzvD/fZzwKc"></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/analytics.min.js.download"></script><script type="text/javascript" async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/recaptcha__en.js.download" crossorigin="anonymous" integrity="sha384-f1gfYQgq4OmhARgCSe1q7WV7tIcPpqu0qD+jYdSEMczD1YXPg0ibdIzvD/fZzwKc"></script><script async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/gtm.js.download"></script><script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"Bishnu","lastname":"Poudel","fullname":"Bishnu Poudel","company":"Coursera","email":"replytobishnu@yahoo.com","origin":"googlecoursera-run, lti-coursera","subscriptions":0,"id":"024695ed22bf9de3de73cb0272a95fe9","qlCreatedAt":"2021-06-09 06:07:35 UTC","optIn":null,"current_organization_id":null,"current_organization_role":null};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="googlecoursera-run";gon.content={"type":"Lab","id":1795,"name":"Predicting Visitor Purchases with a Classification Model with BigQuery ML"};
//]]>
</script>
<script>
  dataLayer = [
    {user: gon.current_user},
    {content: gon.content}
  ];
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-TQR88QK");
</script>
<script>
  EVENT_SOURCE_BASE_URL = "https://googlecoursera-run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/webcomponents-loader-408088dc333247a761de5f2b2a4ba1cabd2bc36579f83ba92a559eb3682a9b77.js.download"></script>
<script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js.download"></script>
<script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/application-33b23f92df5102bcb0f4f8547379eb35a7efe4c3300b66e43ff8f50e5fad1cf3.js.download"></script>
<script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/hallofmirrors-19e951a685fa8811a8b36d459ec6b1b160a131261e98c781f18e69535f0d9a9e.js.download"></script>
<custom-style>
  <style is="custom-style">[hidden] {
  display: none !important;
}

</style>
</custom-style>
<custom-style>
  <style is="custom-style">html {
  --layout_-_display:  flex;;

      --layout-inline_-_display:  inline-flex;;

      --layout-horizontal_-_display:  var(--layout_-_display); --layout-horizontal_-_-ms-flex-direction:  row; --layout-horizontal_-_-webkit-flex-direction:  row; --layout-horizontal_-_flex-direction:  row;;

      --layout-horizontal-reverse_-_display:  var(--layout_-_display); --layout-horizontal-reverse_-_-ms-flex-direction:  row-reverse; --layout-horizontal-reverse_-_-webkit-flex-direction:  row-reverse; --layout-horizontal-reverse_-_flex-direction:  row-reverse;;

      --layout-vertical_-_display:  var(--layout_-_display); --layout-vertical_-_-ms-flex-direction:  column; --layout-vertical_-_-webkit-flex-direction:  column; --layout-vertical_-_flex-direction:  column;;

      --layout-vertical-reverse_-_display:  var(--layout_-_display); --layout-vertical-reverse_-_-ms-flex-direction:  column-reverse; --layout-vertical-reverse_-_-webkit-flex-direction:  column-reverse; --layout-vertical-reverse_-_flex-direction:  column-reverse;;

      --layout-wrap_-_-ms-flex-wrap:  wrap; --layout-wrap_-_-webkit-flex-wrap:  wrap; --layout-wrap_-_flex-wrap:  wrap;;

      --layout-wrap-reverse_-_-ms-flex-wrap:  wrap-reverse; --layout-wrap-reverse_-_-webkit-flex-wrap:  wrap-reverse; --layout-wrap-reverse_-_flex-wrap:  wrap-reverse;;

      --layout-flex-auto_-_-ms-flex:  1 1 auto; --layout-flex-auto_-_-webkit-flex:  1 1 auto; --layout-flex-auto_-_flex:  1 1 auto;;

      --layout-flex-none_-_-ms-flex:  none; --layout-flex-none_-_-webkit-flex:  none; --layout-flex-none_-_flex:  none;;

      --layout-flex_-_-ms-flex:  1 1 0.000000001px; --layout-flex_-_-webkit-flex:  1; --layout-flex_-_flex:  1; --layout-flex_-_-webkit-flex-basis:  0.000000001px; --layout-flex_-_flex-basis:  0.000000001px;;

      --layout-flex-2_-_-ms-flex:  2; --layout-flex-2_-_-webkit-flex:  2; --layout-flex-2_-_flex:  2;;

      --layout-flex-3_-_-ms-flex:  3; --layout-flex-3_-_-webkit-flex:  3; --layout-flex-3_-_flex:  3;;

      --layout-flex-4_-_-ms-flex:  4; --layout-flex-4_-_-webkit-flex:  4; --layout-flex-4_-_flex:  4;;

      --layout-flex-5_-_-ms-flex:  5; --layout-flex-5_-_-webkit-flex:  5; --layout-flex-5_-_flex:  5;;

      --layout-flex-6_-_-ms-flex:  6; --layout-flex-6_-_-webkit-flex:  6; --layout-flex-6_-_flex:  6;;

      --layout-flex-7_-_-ms-flex:  7; --layout-flex-7_-_-webkit-flex:  7; --layout-flex-7_-_flex:  7;;

      --layout-flex-8_-_-ms-flex:  8; --layout-flex-8_-_-webkit-flex:  8; --layout-flex-8_-_flex:  8;;

      --layout-flex-9_-_-ms-flex:  9; --layout-flex-9_-_-webkit-flex:  9; --layout-flex-9_-_flex:  9;;

      --layout-flex-10_-_-ms-flex:  10; --layout-flex-10_-_-webkit-flex:  10; --layout-flex-10_-_flex:  10;;

      --layout-flex-11_-_-ms-flex:  11; --layout-flex-11_-_-webkit-flex:  11; --layout-flex-11_-_flex:  11;;

      --layout-flex-12_-_-ms-flex:  12; --layout-flex-12_-_-webkit-flex:  12; --layout-flex-12_-_flex:  12;;

      

      --layout-start_-_-ms-flex-align:  start; --layout-start_-_-webkit-align-items:  flex-start; --layout-start_-_align-items:  flex-start;;

      --layout-center_-_-ms-flex-align:  center; --layout-center_-_-webkit-align-items:  center; --layout-center_-_align-items:  center;;

      --layout-end_-_-ms-flex-align:  end; --layout-end_-_-webkit-align-items:  flex-end; --layout-end_-_align-items:  flex-end;;

      --layout-baseline_-_-ms-flex-align:  baseline; --layout-baseline_-_-webkit-align-items:  baseline; --layout-baseline_-_align-items:  baseline;;

      

      --layout-start-justified_-_-ms-flex-pack:  start; --layout-start-justified_-_-webkit-justify-content:  flex-start; --layout-start-justified_-_justify-content:  flex-start;;

      --layout-center-justified_-_-ms-flex-pack:  center; --layout-center-justified_-_-webkit-justify-content:  center; --layout-center-justified_-_justify-content:  center;;

      --layout-end-justified_-_-ms-flex-pack:  end; --layout-end-justified_-_-webkit-justify-content:  flex-end; --layout-end-justified_-_justify-content:  flex-end;;

      --layout-around-justified_-_-ms-flex-pack:  distribute; --layout-around-justified_-_-webkit-justify-content:  space-around; --layout-around-justified_-_justify-content:  space-around;;

      --layout-justified_-_-ms-flex-pack:  justify; --layout-justified_-_-webkit-justify-content:  space-between; --layout-justified_-_justify-content:  space-between;;

      --layout-center-center_-_-ms-flex-align:  var(--layout-center_-_-ms-flex-align); --layout-center-center_-_-webkit-align-items:  var(--layout-center_-_-webkit-align-items); --layout-center-center_-_align-items:  var(--layout-center_-_align-items); --layout-center-center_-_-ms-flex-pack:  var(--layout-center-justified_-_-ms-flex-pack); --layout-center-center_-_-webkit-justify-content:  var(--layout-center-justified_-_-webkit-justify-content); --layout-center-center_-_justify-content:  var(--layout-center-justified_-_justify-content);;

      

      --layout-self-start_-_-ms-align-self:  flex-start; --layout-self-start_-_-webkit-align-self:  flex-start; --layout-self-start_-_align-self:  flex-start;;

      --layout-self-center_-_-ms-align-self:  center; --layout-self-center_-_-webkit-align-self:  center; --layout-self-center_-_align-self:  center;;

      --layout-self-end_-_-ms-align-self:  flex-end; --layout-self-end_-_-webkit-align-self:  flex-end; --layout-self-end_-_align-self:  flex-end;;

      --layout-self-stretch_-_-ms-align-self:  stretch; --layout-self-stretch_-_-webkit-align-self:  stretch; --layout-self-stretch_-_align-self:  stretch;;

      --layout-self-baseline_-_-ms-align-self:  baseline; --layout-self-baseline_-_-webkit-align-self:  baseline; --layout-self-baseline_-_align-self:  baseline;;

      

      --layout-start-aligned_-_-ms-flex-line-pack:  start; --layout-start-aligned_-_-ms-align-content:  flex-start; --layout-start-aligned_-_-webkit-align-content:  flex-start; --layout-start-aligned_-_align-content:  flex-start;;

      --layout-end-aligned_-_-ms-flex-line-pack:  end; --layout-end-aligned_-_-ms-align-content:  flex-end; --layout-end-aligned_-_-webkit-align-content:  flex-end; --layout-end-aligned_-_align-content:  flex-end;;

      --layout-center-aligned_-_-ms-flex-line-pack:  center; --layout-center-aligned_-_-ms-align-content:  center; --layout-center-aligned_-_-webkit-align-content:  center; --layout-center-aligned_-_align-content:  center;;

      --layout-between-aligned_-_-ms-flex-line-pack:  justify; --layout-between-aligned_-_-ms-align-content:  space-between; --layout-between-aligned_-_-webkit-align-content:  space-between; --layout-between-aligned_-_align-content:  space-between;;

      --layout-around-aligned_-_-ms-flex-line-pack:  distribute; --layout-around-aligned_-_-ms-align-content:  space-around; --layout-around-aligned_-_-webkit-align-content:  space-around; --layout-around-aligned_-_align-content:  space-around;;

      

      --layout-block_-_display:  block;;

      --layout-invisible_-_visibility:  hidden !important;;

      --layout-relative_-_position:  relative;;

      --layout-fit_-_position:  absolute; --layout-fit_-_top:  0; --layout-fit_-_right:  0; --layout-fit_-_bottom:  0; --layout-fit_-_left:  0;;

      --layout-scroll_-_-webkit-overflow-scrolling:  touch; --layout-scroll_-_overflow:  auto;;

      --layout-fullbleed_-_margin:  0; --layout-fullbleed_-_height:  100vh;;

      

      --layout-fixed-top_-_position:  fixed; --layout-fixed-top_-_top:  0; --layout-fixed-top_-_left:  0; --layout-fixed-top_-_right:  0;;

      --layout-fixed-right_-_position:  fixed; --layout-fixed-right_-_top:  0; --layout-fixed-right_-_right:  0; --layout-fixed-right_-_bottom:  0;;

      --layout-fixed-bottom_-_position:  fixed; --layout-fixed-bottom_-_right:  0; --layout-fixed-bottom_-_bottom:  0; --layout-fixed-bottom_-_left:  0;;

      --layout-fixed-left_-_position:  fixed; --layout-fixed-left_-_top:  0; --layout-fixed-left_-_bottom:  0; --layout-fixed-left_-_left:  0;;
}

</style>
</custom-style><style>[hidden] { display: none !important; }</style><custom-style>
  <style is="custom-style">html {
  --google-red-100: #f4c7c3;
      --google-red-300: #e67c73;
      --google-red-500: #db4437;
      --google-red-700: #c53929;

      --google-blue-100: #c6dafc;
      --google-blue-300: #7baaf7;
      --google-blue-500: #4285f4;
      --google-blue-700: #3367d6;

      --google-green-100: #b7e1cd;
      --google-green-300: #57bb8a;
      --google-green-500: #0f9d58;
      --google-green-700: #0b8043;

      --google-yellow-100: #fce8b2;
      --google-yellow-300: #f7cb4d;
      --google-yellow-500: #f4b400;
      --google-yellow-700: #f09300;

      --google-grey-100: #f5f5f5;
      --google-grey-300: #e0e0e0;
      --google-grey-500: #9e9e9e;
      --google-grey-700: #616161;

      

      --paper-red-50: #ffebee;
      --paper-red-100: #ffcdd2;
      --paper-red-200: #ef9a9a;
      --paper-red-300: #e57373;
      --paper-red-400: #ef5350;
      --paper-red-500: #f44336;
      --paper-red-600: #e53935;
      --paper-red-700: #d32f2f;
      --paper-red-800: #c62828;
      --paper-red-900: #b71c1c;
      --paper-red-a100: #ff8a80;
      --paper-red-a200: #ff5252;
      --paper-red-a400: #ff1744;
      --paper-red-a700: #d50000;

      --paper-pink-50: #fce4ec;
      --paper-pink-100: #f8bbd0;
      --paper-pink-200: #f48fb1;
      --paper-pink-300: #f06292;
      --paper-pink-400: #ec407a;
      --paper-pink-500: #e91e63;
      --paper-pink-600: #d81b60;
      --paper-pink-700: #c2185b;
      --paper-pink-800: #ad1457;
      --paper-pink-900: #880e4f;
      --paper-pink-a100: #ff80ab;
      --paper-pink-a200: #ff4081;
      --paper-pink-a400: #f50057;
      --paper-pink-a700: #c51162;

      --paper-purple-50: #f3e5f5;
      --paper-purple-100: #e1bee7;
      --paper-purple-200: #ce93d8;
      --paper-purple-300: #ba68c8;
      --paper-purple-400: #ab47bc;
      --paper-purple-500: #9c27b0;
      --paper-purple-600: #8e24aa;
      --paper-purple-700: #7b1fa2;
      --paper-purple-800: #6a1b9a;
      --paper-purple-900: #4a148c;
      --paper-purple-a100: #ea80fc;
      --paper-purple-a200: #e040fb;
      --paper-purple-a400: #d500f9;
      --paper-purple-a700: #aa00ff;

      --paper-deep-purple-50: #ede7f6;
      --paper-deep-purple-100: #d1c4e9;
      --paper-deep-purple-200: #b39ddb;
      --paper-deep-purple-300: #9575cd;
      --paper-deep-purple-400: #7e57c2;
      --paper-deep-purple-500: #673ab7;
      --paper-deep-purple-600: #5e35b1;
      --paper-deep-purple-700: #512da8;
      --paper-deep-purple-800: #4527a0;
      --paper-deep-purple-900: #311b92;
      --paper-deep-purple-a100: #b388ff;
      --paper-deep-purple-a200: #7c4dff;
      --paper-deep-purple-a400: #651fff;
      --paper-deep-purple-a700: #6200ea;

      --paper-indigo-50: #e8eaf6;
      --paper-indigo-100: #c5cae9;
      --paper-indigo-200: #9fa8da;
      --paper-indigo-300: #7986cb;
      --paper-indigo-400: #5c6bc0;
      --paper-indigo-500: #3f51b5;
      --paper-indigo-600: #3949ab;
      --paper-indigo-700: #303f9f;
      --paper-indigo-800: #283593;
      --paper-indigo-900: #1a237e;
      --paper-indigo-a100: #8c9eff;
      --paper-indigo-a200: #536dfe;
      --paper-indigo-a400: #3d5afe;
      --paper-indigo-a700: #304ffe;

      --paper-blue-50: #e3f2fd;
      --paper-blue-100: #bbdefb;
      --paper-blue-200: #90caf9;
      --paper-blue-300: #64b5f6;
      --paper-blue-400: #42a5f5;
      --paper-blue-500: #2196f3;
      --paper-blue-600: #1e88e5;
      --paper-blue-700: #1976d2;
      --paper-blue-800: #1565c0;
      --paper-blue-900: #0d47a1;
      --paper-blue-a100: #82b1ff;
      --paper-blue-a200: #448aff;
      --paper-blue-a400: #2979ff;
      --paper-blue-a700: #2962ff;

      --paper-light-blue-50: #e1f5fe;
      --paper-light-blue-100: #b3e5fc;
      --paper-light-blue-200: #81d4fa;
      --paper-light-blue-300: #4fc3f7;
      --paper-light-blue-400: #29b6f6;
      --paper-light-blue-500: #03a9f4;
      --paper-light-blue-600: #039be5;
      --paper-light-blue-700: #0288d1;
      --paper-light-blue-800: #0277bd;
      --paper-light-blue-900: #01579b;
      --paper-light-blue-a100: #80d8ff;
      --paper-light-blue-a200: #40c4ff;
      --paper-light-blue-a400: #00b0ff;
      --paper-light-blue-a700: #0091ea;

      --paper-cyan-50: #e0f7fa;
      --paper-cyan-100: #b2ebf2;
      --paper-cyan-200: #80deea;
      --paper-cyan-300: #4dd0e1;
      --paper-cyan-400: #26c6da;
      --paper-cyan-500: #00bcd4;
      --paper-cyan-600: #00acc1;
      --paper-cyan-700: #0097a7;
      --paper-cyan-800: #00838f;
      --paper-cyan-900: #006064;
      --paper-cyan-a100: #84ffff;
      --paper-cyan-a200: #18ffff;
      --paper-cyan-a400: #00e5ff;
      --paper-cyan-a700: #00b8d4;

      --paper-teal-50: #e0f2f1;
      --paper-teal-100: #b2dfdb;
      --paper-teal-200: #80cbc4;
      --paper-teal-300: #4db6ac;
      --paper-teal-400: #26a69a;
      --paper-teal-500: #009688;
      --paper-teal-600: #00897b;
      --paper-teal-700: #00796b;
      --paper-teal-800: #00695c;
      --paper-teal-900: #004d40;
      --paper-teal-a100: #a7ffeb;
      --paper-teal-a200: #64ffda;
      --paper-teal-a400: #1de9b6;
      --paper-teal-a700: #00bfa5;

      --paper-green-50: #e8f5e9;
      --paper-green-100: #c8e6c9;
      --paper-green-200: #a5d6a7;
      --paper-green-300: #81c784;
      --paper-green-400: #66bb6a;
      --paper-green-500: #4caf50;
      --paper-green-600: #43a047;
      --paper-green-700: #388e3c;
      --paper-green-800: #2e7d32;
      --paper-green-900: #1b5e20;
      --paper-green-a100: #b9f6ca;
      --paper-green-a200: #69f0ae;
      --paper-green-a400: #00e676;
      --paper-green-a700: #00c853;

      --paper-light-green-50: #f1f8e9;
      --paper-light-green-100: #dcedc8;
      --paper-light-green-200: #c5e1a5;
      --paper-light-green-300: #aed581;
      --paper-light-green-400: #9ccc65;
      --paper-light-green-500: #8bc34a;
      --paper-light-green-600: #7cb342;
      --paper-light-green-700: #689f38;
      --paper-light-green-800: #558b2f;
      --paper-light-green-900: #33691e;
      --paper-light-green-a100: #ccff90;
      --paper-light-green-a200: #b2ff59;
      --paper-light-green-a400: #76ff03;
      --paper-light-green-a700: #64dd17;

      --paper-lime-50: #f9fbe7;
      --paper-lime-100: #f0f4c3;
      --paper-lime-200: #e6ee9c;
      --paper-lime-300: #dce775;
      --paper-lime-400: #d4e157;
      --paper-lime-500: #cddc39;
      --paper-lime-600: #c0ca33;
      --paper-lime-700: #afb42b;
      --paper-lime-800: #9e9d24;
      --paper-lime-900: #827717;
      --paper-lime-a100: #f4ff81;
      --paper-lime-a200: #eeff41;
      --paper-lime-a400: #c6ff00;
      --paper-lime-a700: #aeea00;

      --paper-yellow-50: #fffde7;
      --paper-yellow-100: #fff9c4;
      --paper-yellow-200: #fff59d;
      --paper-yellow-300: #fff176;
      --paper-yellow-400: #ffee58;
      --paper-yellow-500: #ffeb3b;
      --paper-yellow-600: #fdd835;
      --paper-yellow-700: #fbc02d;
      --paper-yellow-800: #f9a825;
      --paper-yellow-900: #f57f17;
      --paper-yellow-a100: #ffff8d;
      --paper-yellow-a200: #ffff00;
      --paper-yellow-a400: #ffea00;
      --paper-yellow-a700: #ffd600;

      --paper-amber-50: #fff8e1;
      --paper-amber-100: #ffecb3;
      --paper-amber-200: #ffe082;
      --paper-amber-300: #ffd54f;
      --paper-amber-400: #ffca28;
      --paper-amber-500: #ffc107;
      --paper-amber-600: #ffb300;
      --paper-amber-700: #ffa000;
      --paper-amber-800: #ff8f00;
      --paper-amber-900: #ff6f00;
      --paper-amber-a100: #ffe57f;
      --paper-amber-a200: #ffd740;
      --paper-amber-a400: #ffc400;
      --paper-amber-a700: #ffab00;

      --paper-orange-50: #fff3e0;
      --paper-orange-100: #ffe0b2;
      --paper-orange-200: #ffcc80;
      --paper-orange-300: #ffb74d;
      --paper-orange-400: #ffa726;
      --paper-orange-500: #ff9800;
      --paper-orange-600: #fb8c00;
      --paper-orange-700: #f57c00;
      --paper-orange-800: #ef6c00;
      --paper-orange-900: #e65100;
      --paper-orange-a100: #ffd180;
      --paper-orange-a200: #ffab40;
      --paper-orange-a400: #ff9100;
      --paper-orange-a700: #ff6500;

      --paper-deep-orange-50: #fbe9e7;
      --paper-deep-orange-100: #ffccbc;
      --paper-deep-orange-200: #ffab91;
      --paper-deep-orange-300: #ff8a65;
      --paper-deep-orange-400: #ff7043;
      --paper-deep-orange-500: #ff5722;
      --paper-deep-orange-600: #f4511e;
      --paper-deep-orange-700: #e64a19;
      --paper-deep-orange-800: #d84315;
      --paper-deep-orange-900: #bf360c;
      --paper-deep-orange-a100: #ff9e80;
      --paper-deep-orange-a200: #ff6e40;
      --paper-deep-orange-a400: #ff3d00;
      --paper-deep-orange-a700: #dd2c00;

      --paper-brown-50: #efebe9;
      --paper-brown-100: #d7ccc8;
      --paper-brown-200: #bcaaa4;
      --paper-brown-300: #a1887f;
      --paper-brown-400: #8d6e63;
      --paper-brown-500: #795548;
      --paper-brown-600: #6d4c41;
      --paper-brown-700: #5d4037;
      --paper-brown-800: #4e342e;
      --paper-brown-900: #3e2723;

      --paper-grey-50: #fafafa;
      --paper-grey-100: #f5f5f5;
      --paper-grey-200: #eeeeee;
      --paper-grey-300: #e0e0e0;
      --paper-grey-400: #bdbdbd;
      --paper-grey-500: #9e9e9e;
      --paper-grey-600: #757575;
      --paper-grey-700: #616161;
      --paper-grey-800: #424242;
      --paper-grey-900: #212121;

      --paper-blue-grey-50: #eceff1;
      --paper-blue-grey-100: #cfd8dc;
      --paper-blue-grey-200: #b0bec5;
      --paper-blue-grey-300: #90a4ae;
      --paper-blue-grey-400: #78909c;
      --paper-blue-grey-500: #607d8b;
      --paper-blue-grey-600: #546e7a;
      --paper-blue-grey-700: #455a64;
      --paper-blue-grey-800: #37474f;
      --paper-blue-grey-900: #263238;

      
      --dark-divider-opacity: 0.12;
      --dark-disabled-opacity: 0.38; 
      --dark-secondary-opacity: 0.54;
      --dark-primary-opacity: 0.87;

      
      --light-divider-opacity: 0.12;
      --light-disabled-opacity: 0.3; 
      --light-secondary-opacity: 0.7;
      --light-primary-opacity: 1.0;
}

</style>
</custom-style><custom-style>
  <style is="custom-style">html {
  --primary-text-color: var(--light-theme-text-color);
      --primary-background-color: var(--light-theme-background-color);
      --secondary-text-color: var(--light-theme-secondary-color);
      --disabled-text-color: var(--light-theme-disabled-color);
      --divider-color: var(--light-theme-divider-color);
      --error-color: var(--paper-deep-orange-a700);

      
      --primary-color: var(--paper-indigo-500);
      --light-primary-color: var(--paper-indigo-100);
      --dark-primary-color: var(--paper-indigo-700);

      --accent-color: var(--paper-pink-a200);
      --light-accent-color: var(--paper-pink-a100);
      --dark-accent-color: var(--paper-pink-a400);


      
      --light-theme-background-color: #ffffff;
      --light-theme-base-color: #000000;
      --light-theme-text-color: var(--paper-grey-900);
      --light-theme-secondary-color: #737373;  
      --light-theme-disabled-color: #9b9b9b;  
      --light-theme-divider-color: #dbdbdb;

      
      --dark-theme-background-color: var(--paper-grey-900);
      --dark-theme-base-color: #ffffff;
      --dark-theme-text-color: #ffffff;
      --dark-theme-secondary-color: #bcbcbc;  
      --dark-theme-disabled-color: #646464;  
      --dark-theme-divider-color: #3c3c3c;

      
      --text-primary-color: var(--dark-theme-text-color);
      --default-primary-color: var(--primary-color);
}

</style>
</custom-style><script async="" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/lazy.min.js.download"></script><script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/loader.js.download"></script>
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script id="ze-snippet" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/snippet.js.download"></script>


<meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="nFR++367jzvfHWn0UQeAWByStvnrBJh/7iilHvwL1fIR0tuaidNCCg6mphtfq6GXzrucg2RqQsol70hTCXkroA==">
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport">
<meta content="1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0" name="google-site-verification">
<meta content="#3681E4" property="msapplication-TileColor">
<meta content="/favicon-144.png" property="msapplication-TileImage">
<meta content="[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:1,&quot;variant&quot;:&quot;no_recaptcha&quot;}]" name="active-experiments">
<meta content="{&quot;userId&quot;:5037645}" name="help-api-product-data">
<meta content="Want to build ML models with just SQL? Learn how with BigQuery ML on this Google Analytics ecommerce dataset" name="description">
<meta content="Qwiklabs" name="author">
<meta content="Predicting Visitor Purchases with a Classification Model with BigQuery ML | Qwiklabs" property="og:title">
<meta content="website" property="og:type">
<meta content="/favicon-144.png" property="og:image">
<meta content="Qwiklabs" property="og:site_name">
<meta content="Want to build ML models with just SQL? Learn how with BigQuery ML on this Google Analytics ecommerce dataset" property="og:description">
<meta content="/qwiklabs_logo_900x887.png" property="og:logo" size="900x887">
<meta content="/qwiklabs_logo_994x187.png" property="og:logo" size="994x187">


<link href="https://googlecoursera.qwiklabs.com/favicon-32.png" rel="shortcut icon">
<link color="#3681E4" href="https://googlecoursera.qwiklabs.com/favicon-svg.svg" rel="mask-icon">
<link href="https://googlecoursera.qwiklabs.com/favicon-180.png" rel="apple-touch-icon-precomposed">



<link rel="stylesheet" media="screen" href="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/css">


<link rel="stylesheet" media="all" href="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/application-fb473edc053b24560c69f1d5be0cd02986f15b92ec98669f3b5cf737362461cc.css">



</head>
<body class="lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav ">
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-TQR88QK' style='display:none;visibility:hidden;' width='0'></iframe>
</noscript>
<span class="hidden" id="flash-sibling-before"></span>

<div class="header-container">
<div class="header">
<ql-icon-button class="js-nav-toggle header__nav-panel-button l-mrm">menu</ql-icon-button>
<div class="header__title">
<ql-icon-button label="Back" href="https://www.coursera.org/" id="2f5c1717d7dca9c4" target="_self" tabindex="0">arrow_back</ql-icon-button><div class="mdl-tooltip" data-mdl-for="2f5c1717d7dca9c4" data-upgraded=",MaterialTooltip">Back</div>

<h1 class="headline-5">
Predicting Visitor Purchases with a Classification Model with BigQuery ML
</h1>
</div>
<div class="header__actions">
<ql-icon-button class="header__button--search js-header-search-bar-button">search</ql-icon-button>
<ql-icon-button id="control-panel-target" style="display: none;" aria-haspopup="true" aria-controls="control-panel-menu">
dashboard
</ql-icon-button>
<ql-menu for="control-panel-target" id="control-panel-menu" style="left: -1000px; top: -1000px; opacity: 0; visibility: hidden;" role="menu" aria-labelledby="control-panel-target"></ql-menu>

<ql-icon-button id="help-menu-button" aria-haspopup="true" aria-controls="help-menu" tabindex="0">help</ql-icon-button>
<div class="mdl-tooltip js-tooltip" data-mdl-for="help-menu-button" data-upgraded=",MaterialTooltip">
Help
</div>
<ql-menu for="help-menu-button" id="help-menu" style="left: -1000px; top: -1000px; opacity: 0; visibility: hidden;" role="menu" aria-labelledby="help-menu-button">
<ql-menu-item>
<ql-help context="lab" data-analytics-action="opened_help" data-analytics-label="lab" productdata="{&quot;userId&quot;:5037645}">
Help Center
</ql-help>
</ql-menu-item>
<ql-menu-item>
<a target="_blank" class="ql-body-1" href="https://support.google.com/qwiklabs/contact/contact_us" tabindex="-1" role="menuitem">Email support</a>
</ql-menu-item>
<ql-menu-item>
<a class="ql-body-1" onclick="ql.chat.open()" tabindex="-1" role="menuitem">Chat support</a>
</ql-menu-item>
</ql-menu>

<ql-icon-button id="language">language</ql-icon-button>
<div class="mdl-menu__container is-upgraded"><div class="mdl-menu__outline"></div><div class="mdl-menu mdl-menu__bottom-right mdl-js-menu elevation-3" for="language" data-upgraded=",MaterialMenu">
<a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ar" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=ar&amp;parent=lti_session" tabindex="-1">العربية‬‎
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="de" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=de&amp;parent=lti_session" tabindex="-1">Deutsch
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="en" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=en&amp;parent=lti_session" tabindex="-1">English
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="es" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=es&amp;parent=lti_session" tabindex="-1">español (Latinoamérica)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="fr" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=fr&amp;parent=lti_session" tabindex="-1">français
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="id" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=id&amp;parent=lti_session" tabindex="-1">bahasa Indonesia
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="it" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=it&amp;parent=lti_session" tabindex="-1">Italiano
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ja" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=ja&amp;parent=lti_session" tabindex="-1">日本語
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ko" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=ko&amp;parent=lti_session" tabindex="-1">한국어
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pl" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=pl&amp;parent=lti_session" tabindex="-1">Polski
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_BR" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=pt_BR&amp;parent=lti_session" tabindex="-1">português (Brasil)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_PT" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=pt_PT&amp;parent=lti_session" tabindex="-1">português (Portugal)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ru" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=ru&amp;parent=lti_session" tabindex="-1">русский
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="tr" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=tr&amp;parent=lti_session" tabindex="-1">Türkçe
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=zh&amp;parent=lti_session" tabindex="-1">简体中文
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh_TW" href="https://googlecoursera.qwiklabs.com/focuses/16187033?locale=zh_TW&amp;parent=lti_session" tabindex="-1">繁體中文
</a></div></div>
<button aria-label="My Account menu button" class="icon-button" id="my_account" aria-haspopup="true" aria-controls="">
<ql-avatar></ql-avatar>
</button>
<ql-menu for="my_account" open="" style="left: -1000px; top: -1000px; opacity: 0; visibility: hidden;" role="menu" aria-labelledby="my_account">
<div class="my-account-menu">
<ql-avatar class="l-mtl l-mbl" size="120"></ql-avatar>
<div class="my-account-menu__user-info l-mbl">
<h4 class="ql-subhead-1">Bishnu Poudel</h4>
<p class="ql-body-2 text--light">replytobishnu@yahoo.com</p>
<p class="ql-body-2 text--light">
</p>
<a class="text--green ql-subhead-2" href="https://googlecoursera.qwiklabs.com/my_account/payments"><ql-chip positive="">
0 Credits
</ql-chip>
</a></div>
<div class="buttons l-mbl">
<a class="button button--hairline" id="settings" href="https://googlecoursera.qwiklabs.com/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action="clicked_sign_out" href="/users/sign_out" method="delete">
Sign Out
</ql-button>
<div class="privacy l-mtl">
<a class="ql-caption text--light" href="https://googlecoursera.qwiklabs.com/privacy_policy">Privacy</a>
<span class="ql-caption text--light l-mls l-mrs">·</span>
<a class="ql-caption text--light" href="https://googlecoursera.qwiklabs.com/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</div>
<div class="header__search-bar js-header-search-bar">
<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="https://googlecoursera.qwiklabs.com/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="nFR++367jzvfHWn0UQeAWByStvnrBJh/7iilHvwL1fIR0tuaidNCCg6mphtfq6GXzrucg2RqQsol70hTCXkroA==">
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar">
</form>

<ql-icon-button class="js-close-search-bar">close</ql-icon-button>
</div>
</div>

<nav class="nav-bar">
<a class="nav-bar__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/"><ql-icon class="nav-bar__item__icon">
home
</ql-icon>
<span class="nav-bar__item__label">
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/catalog"><ql-icon class="nav-bar__item__icon">
school
</ql-icon>
<span class="nav-bar__item__label">
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/my_learning"><ql-icon class="nav-bar__item__icon">
event_note
</ql-icon>
<span class="nav-bar__item__label">
My Learning
</span>
</a>
</nav>

<nav class="nav-panel js-nav-panel">
<div class="nav-panel__logo">
<div class="logo logo--blue"></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/"><ql-icon class="nav-panel__item__icon">
home
</ql-icon>
<div class="nav-panel__item__label">
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/catalog"><ql-icon class="nav-panel__item__icon">
school
</ql-icon>
<div class="nav-panel__item__label">
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/my_learning"><ql-icon class="nav-panel__item__icon">
event_note
</ql-icon>
<div class="nav-panel__item__label">
My Learning
</div>
</a>
<div class="nav-panel__spacer"></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/my_account/profile"><ql-icon class="nav-panel__item__icon">
account_circle
</ql-icon>
<div class="nav-panel__item__label">
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/my_account/credits"><ql-icon class="nav-panel__item__icon">
money
</ql-icon>
<div class="nav-panel__item__label">
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="https://googlecoursera.qwiklabs.com/my_account/security"><ql-icon class="nav-panel__item__icon">
security
</ql-icon>
<div class="nav-panel__item__label">
Security
</div>
</a>
<div class="nav-panel__spacer"></div>
<a class="nav-panel__item" tabindex="-1" href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#"><ql-help>
<div class="nav-panel__help-item">
<ql-icon class="nav-panel__item__icon">help</ql-icon>
<div class="nav-panel__item__label">
Help
</div>
</div>
</ql-help>
</a><div class="nav-panel__small-links">
<a tabindex="-1" href="https://googlecoursera.qwiklabs.com/privacy_policy">Privacy</a>
<a tabindex="-1" href="https://googlecoursera.qwiklabs.com/terms_of_service">Terms</a>
</div>
</nav>
<div class="nav-panel__overlay js-nav-toggle"></div>

<main class="js-main">
<div class="l-main-wrapper" id="main-wrapper">







<ql-drawer-container class="js-lab-state" data-analytics-payload="{&quot;label&quot;:&quot;Predicting Visitor Purchases with a Classification Model with BigQuery ML&quot;,&quot;lab_name&quot;:&quot;Predicting Visitor Purchases with a Classification Model with BigQuery ML&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;googlecoursera-run&quot;}" data-focus-id="16187033" data-lab-billing-limit="0.0" data-lab-duration="4800" data-parent="lti_session" data-recaptcha-enabled="" id="lab-container">
<ql-drawer id="terminal-drawer" slot="drawer" style="width: calc(100% - 480px)">
<iframe allow="clipboard-read" class="terminal" id="embedded-resource" __idm_frm__="637" data-gtm-yt-inspected-1_25="true" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(1).html"></iframe>
</ql-drawer>
<ql-drawer-content class="js-lab-wrapper" id="lab-content" slot="drawer-content">
<ql-drawer-container id="lab-content-container">
<ql-drawer id="control-panel-drawer" open="" slot="drawer" width="320" style="width: 320px;">
<ql-lab-control-panel class="ql-lab-control-panel__max-height control-panel js-lab-control-panel" connectionfiles="[]" labcontrolbutton="{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}" labdetails="[]" labtimer="{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:4800}" studentresources="[]">
<script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/api.js.download"></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
              grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                    var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
            var element = document.getElementById(id);
            element.value = token;
          }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response " style="" value="03AGdBq25CwLWQHOu_cxx8m_dPphVtWWCUdhppIn7iPf4kx9TQ6ir6rjOkwLD3L9QlQ253j7EsUxTX0FjfpoEIpxfuLYINHWbdxiWZRjlL71j3QmpVKuavC9SsXgRWhKK_dwbFQeAwuX-urLGPUAMYzDq5SvIHsFrz7lDn46niqlxlnprhvmSxny-nkMfkGI4rMpQoWBg714h7zJNyy3CJYKAJ1TPNd2EIaPzSmByfo9ShgVD0a9MAUIBrg8s0BE-i01cbLCGHVRkNgmf6gR8_txcda8prhWBoTZe8Qud2myn7gpyaoi0hK00CpcNyUxFiMKJSdbrMnTmqHjHX6EqUoSEqUNKep8MRFhHbvyOFcDLlllcc_TTPud8zLHm1kfTiy6HEqNCp5-UVYifz8i7U50P4ih1c8enPehWw5iNXZN56z67YNlM1N0dZfHGr2mAaPhAlw4I_PrNOyE4VbdPWSh2EWE-lEttOTwuOd5JJDP7wFj6hSkZFEZPkz5fRgHeugXSFa_0-o83oReuhHiAF0M9LrUzNqV-_SwsUTcLLVDT12Zl5xJvmX6j3qvzbpL9iFVB6_F5zg3M8Q0Nwlcrd_md-ghi8qSHKQGdQfijt_voVjJFt9_uZcSFg4dGw-_UOOP-KovWI31y6jNHrJnys5WqTQ0mY_DYWS-QElr8X7mOXYN-Qa3t0TDSDxsJd8n6puiPkHSANl7GS6VFRuaXMj7Je01T3kId1CsLNvE5ALjVqTffDJVtShddGOkIQmhX-GzOiZkP60IBbvIcRijbGmV22IxoO51Fpi0BdgO8qE8shDfDR3Izik1lxl0M5T77nc9z7XTN6vtRWWPe8380lYOHvP4GENSZZy3pg57xvcAtnr6Zs_Y51nWxFisHTrdwf4JFOYJv3GEAcJV1vN3GBdXJrqDH8iYTBKxNWiKuiH50z0FtkOjwi9Z88WqTt5NrMvIbOqtcrxeIAkpnVr5Y7P9I_39l1ntcFT8_XAvaiP-Lwa-uD3mw6n8iHwzrgDPko9vQkoYX1AlEhlm8PiLD9aOXrUsgmBT5-QYOwgK5NWOwKI-PVP0qYn3yjAsivnx6hm0Brkg5nTp6ZTw_ESKBqZ4VSH6bRz4n-CQNreihmyEAkgZ3I1cDVW1HFnRN4kSPtKZW3jcAZoCjdXY-qJVii-b9fVqhc255MYg"><div style="width: 304px; height: 78px;"><div><iframe title="reCAPTCHA" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/anchor.html" width="304" height="78" role="presentation" name="a-gpro3cdw2l0y" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox" data-gtm-yt-inspected-1_25="true"></iframe></div><textarea id="g-recaptcha-response" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div></input>

<div class="hidden" id="recaptcha-v2-start-lab" slot="recaptcha">
<script src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/api.js(1).download" async="" defer=""></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "><div style="width: 304px; height: 78px;"><div><iframe title="reCAPTCHA" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/anchor(1).html" width="304" height="78" role="presentation" name="a-b13dm2x5wcd9" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox" data-gtm-yt-inspected-1_25="true"></iframe></div><textarea id="g-recaptcha-response-1" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><iframe data-gtm-yt-inspected-1_25="true" __idm_frm__="649" style="display: none;" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(2).html"></iframe></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id="lab-instructions" slot="drawer-content">
<div class="alert alert--fake js-alert">
<p class="alert__message js-alert-message"></p>
<a class="alert__close js-alert-close">
<i class="fa fa-times"></i>
</a>
<iframe class="l-ie-iframe-fix" __idm_frm__="638" data-gtm-yt-inspected-1_25="true" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(3).html"></iframe>
</div>
<div class="js-lab-content lab-content__renderable-instructions">
<div class="lab-preamble">
<h1 class="lab-preamble__title">
Predicting Visitor Purchases with a Classification Model with BigQuery ML
</h1>
<div class="lab-preamble__details subtitle-headline-1">
<span>1 hour 20 minutes</span>
<span>Free</span>
<div class="lab__rating">
<a href="https://googlecoursera.qwiklabs.com/focuses/16187033/reviews?parent=lti_session"><div class="rateit" data-rateit-readonly="true" data-rateit-value="4.4536"><div class="rateit-reset" style="display: none;"></div><div class="rateit-range" style="width: 80px; height: 16px;"><div class="rateit-selected" style="height: 16px; width: 71.2576px;"></div><div class="rateit-hover" style="height:16px"></div></div></div>

</a><a data-target="#lab-review-modal" data-toggle="modal">
Rate Lab
</a>
</div>
</div>
</div>

<div class="js-markdown-instructions markdown-lab-instructions" id="markdown-lab-instructions">



<h2 id="step1">Overview</h2>
<p><a href="https://cloud.google.com/bigquery/docs/bigqueryml-analyst-start" target="_blank">BigQuery ML</a> (BigQuery machine learning) is a feature in BigQuery where data analysts can create, train, evaluate, and predict with machine learning models with minimal coding.</p>
<p>The Google Analytics Sample <a href="https://www.blog.google/products/marketingplatform/analytics/introducing-google-analytics-sample" target="_blank">Ecommerce dataset</a> that has millions of Google Analytics records for the <a href="https://shop.googlemerchandisestore.com/" target="_blank">Google Merchandise Store</a> loaded into BigQuery. In this lab, you will use this data to run some typical queries that businesses would want to know about their customers' purchasing habits.</p>
<h3>Objectives</h3>
<p>In this lab, you learn to perform the following tasks:</p>
<ul>
<li>
<p>Use BigQuery to find public datasets</p>
</li>
<li>
<p>Query and explore the ecommerce dataset</p>
</li>
<li>
<p>Create a training and evaluation dataset to be used for batch prediction</p>
</li>
<li>
<p>Create a classification (logistic regression) model in BigQuery ML</p>
</li>
<li>
<p>Evaluate the performance of your machine learning model</p>
</li>
<li>
<p>Predict and rank the probability that a visitor will make a purchase</p>
</li>
</ul>
<h2 id="step2">Set up your environments</h2>
<h3>Qwiklabs setup</h3>
<p>For each lab, you get a new GCP project and set of resources for a fixed time at no cost.</p>
<ol>
<li>
<p>Make sure you signed into Qwiklabs using an <strong>incognito window</strong>.</p>
</li>
<li>
<p>Note the lab's access time (for example, <img alt="img/time.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/aZQJ4BT7uCmM9XR6BTXgTRP1Hfu1T7q6V+cnbdEsbpU="> and make sure you can finish in that time block.</p>
</li>
</ol>
<aside> <p>
  There is no pause feature. You can restart if needed, but you have to start at the beginning.
  </p>

</aside>
<ol start="3">
<li>
<p>When ready, click <img alt="img/start_lab.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/XE8x7uvQokyubNwnYKKc+vBBNrMlo5iNZiDDzQQ3Ddo=">.</p>
</li>
<li>
<p>Note your lab credentials. You will use them to sign in to Cloud Platform Console.
<img alt="img/open_google_console.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/0d78dhX6IVMVWmixCPPSBbmi5O2GPokCXf1Ps1AkTgI="></p>
</li>
<li>
<p>Click <strong>Open Google Console</strong>.</p>
</li>
<li>
<p>Click <strong>Use another account</strong> and copy/paste credentials for <strong>this</strong> lab into the prompts.</p>
</li>
</ol>
<aside class="warning"><p>
  If you use other credentials, you'll get errors or <strong>incur charges</strong>.
  </p>
</aside>
<ol start="7">
<li>Accept the terms and skip the recovery resource page.</li>
</ol>
<aside class="warning"><p>
  Do not click <strong>End Lab</strong> unless you are finished with the lab or want to restart it. This clears your work and removes the project.
  </p>
</aside>

<h3>Open BigQuery Console</h3>
<p>In the Google Cloud Console, select <strong>Navigation menu</strong> &gt; <strong>BigQuery</strong>:</p>
<p><img alt="BigQuery_menu.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/QwUX6algdXPgIThqBlgB2rnqGkoQUUANkl3xicD06uc="></p>
<p>The <strong>Welcome to BigQuery in the Cloud Console</strong> message box opens. This message box provides a link to the quickstart guide and lists UI updates.</p>
<p>Click <strong>Done</strong>.</p>

<h3>Access the course dataset</h3>
<p>Once BigQuery is open, open <a href="https://console.cloud.google.com/bigquery?p=data-to-insights&amp;d=ecommerce&amp;t=web_analytics&amp;page=table" target="_blank">data-to-insights</a> project in a new browser tab to bring this project into your BigQuery projects panel.</p>
<p>The field definitions for the <strong>data-to-insights</strong> ecommerce dataset are <a href="https://support.google.com/analytics/answer/3437719?hl=en" target="_blank">here</a>. Keep the link open in a new tab for reference.</p>
<h2 id="step3">Task 1. Explore ecommerce data</h2>
<p><strong>Scenario:</strong> Your data analyst team exported the Google Analytics logs for an ecommerce website into BigQuery and created a new table of all the raw ecommerce visitor session data for you to explore. Using this data, you'll try to answer a few questions.</p>
<p><strong>Question:</strong> Out of the total visitors who visited our website, what % made a purchase?</p>
<ol>
<li>
<p>Click the <strong>Query editor</strong>.</p>
</li>
<li>
<p>Add the following to the New Query field:</p>
</li>
</ol>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="com">#standardSQL</span><span class="pln">
WITH visitors AS</span><span class="pun">(</span><span class="pln">
SELECT
COUNT</span><span class="pun">(</span><span class="pln">DISTINCT fullVisitorId</span><span class="pun">)</span><span class="pln"> AS total_visitors
FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
</span><span class="pun">),</span><span class="pln">

purchasers AS</span><span class="pun">(</span><span class="pln">
SELECT
COUNT</span><span class="pun">(</span><span class="pln">DISTINCT fullVisitorId</span><span class="pun">)</span><span class="pln"> AS total_purchasers
FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
WHERE totals</span><span class="pun">.</span><span class="pln">transactions IS NOT NULL
</span><span class="pun">)</span><span class="pln">

SELECT
  total_visitors</span><span class="pun">,</span><span class="pln">
  total_purchasers</span><span class="pun">,</span><span class="pln">
  total_purchasers </span><span class="pun">/</span><span class="pln"> total_visitors AS conversion_rate
FROM visitors</span><span class="pun">,</span><span class="pln"> purchasers</span></code><button class="button button--text button--small copy-button js-copy-button-0"><ql-icon>content_copy</ql-icon></button></pre>
<ol start="3">
<li>Click <strong>Run</strong>.</li>
</ol>
<p>The result: 2.69%</p>
<p><strong>Question:</strong> What are the top 5 selling products?</p>
<ol start="4">
<li>
<p>Add the following query in the <strong>Query editor</strong>, and then click <strong>Run</strong>:</p>
</li>
</ol>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">SELECT
  p</span><span class="pun">.</span><span class="pln">v2ProductName</span><span class="pun">,</span><span class="pln">
  p</span><span class="pun">.</span><span class="pln">v2ProductCategory</span><span class="pun">,</span><span class="pln">
  SUM</span><span class="pun">(</span><span class="pln">p</span><span class="pun">.</span><span class="pln">productQuantity</span><span class="pun">)</span><span class="pln"> AS units_sold</span><span class="pun">,</span><span class="pln">
  ROUND</span><span class="pun">(</span><span class="pln">SUM</span><span class="pun">(</span><span class="pln">p</span><span class="pun">.</span><span class="pln">localProductRevenue</span><span class="pun">/</span><span class="lit">1000000</span><span class="pun">),</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> AS revenue
FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h</span><span class="pun">,</span><span class="pln">
UNNEST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">product</span><span class="pun">)</span><span class="pln"> AS p
GROUP BY </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
ORDER BY revenue DESC
LIMIT </span><span class="lit">5</span><span class="pun">;</span></code><button class="button button--text button--small copy-button js-copy-button-1"><ql-icon>content_copy</ql-icon></button></pre>
<p>The result:</p>
<table>

<tbody><tr>
<th>Row</th>
<th>v2ProductName</th>
<th>v2ProductCategory</th>
<th>units_sold</th>
<th>revenue</th>
</tr>


<tr>
<td>1</td>
<td>Nest® Learning Thermostat 3rd Gen-USA - Stainless Steel</td>
<td>Nest-USA</td>
<td>17651</td>
<td>870976.95</td>
</tr>
<tr>
<td>2</td>
<td>Nest® Cam Outdoor Security Camera - USA</td>
<td>Nest-USA</td>
<td>16930</td>
<td>684034.55</td>
</tr>
<tr>
<td>3</td>
<td>Nest® Cam Indoor Security Camera - USA</td>
<td>Nest-USA</td>
<td>14155</td>
<td>548104.47</td>
</tr>
<tr>
<td>4</td>
<td>Nest® Protect Smoke + CO White Wired Alarm-USA</td>
<td>Nest-USA</td>
<td>6394</td>
<td>178937.6</td>
</tr>
<tr>
<td>5</td>
<td>Nest® Protect Smoke + CO White Battery Alarm-USA</td>
<td>Nest-USA</td>
<td>6340</td>
<td>178572.4</td>
</tr>

</tbody></table>
<p><strong>Question:</strong> How many visitors bought on subsequent visits to the website?</p>
<ol start="5">
<li>
<p>Run the following query to find out:</p>
</li>
</ol>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="com"># visitors who bought on a return visit (could have bought on first as well</span><span class="pln">
WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
SELECT
  fullvisitorid</span><span class="pun">,</span><span class="pln"> </span><span class="com"># 741,721 unique visitors</span><span class="pln">
  IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid
</span><span class="pun">)</span><span class="pln">

SELECT
  COUNT</span><span class="pun">(</span><span class="pln">DISTINCT fullvisitorid</span><span class="pun">)</span><span class="pln"> AS total_visitors</span><span class="pun">,</span><span class="pln">
  will_buy_on_return_visit
FROM all_visitor_stats
GROUP BY will_buy_on_return_visit</span></code><button class="button button--text button--small copy-button js-copy-button-2"><ql-icon>content_copy</ql-icon></button></pre>
<p>The results:</p>
<table>

<tbody><tr>
<th>Row</th>
<th>total_visitors</th>
<th>will_buy_on_return_visit</th>
</tr>


<tr>
<td>1</td>
<td>729848</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>11873</td>
<td>1</td>
</tr>

</tbody></table>
<p>Analyzing the results, you can see that (11873 / 729848) = 1.6% of total visitors will return and purchase from the website. This includes the subset of visitors who bought on their very first session and then came back and bought again.</p>
<p><ql-multiple-select-probe answerindices="[0, 1, 2]" optiontitles="[
&quot;The customer wants to comparison shop on other sites before making a purchase decision.&quot;,
&quot;The customer is waiting for products to go on sale or other promotion&quot;,
&quot;The customer is doing additional research&quot;
]" stem="What are some of the reasons a typical ecommerce customer will browse but not buy until a later visit? Choose all that could apply.">
</ql-multiple-select-probe></p>
<p>This behavior is very common for luxury goods where significant up-front research and comparison is required by the customer before deciding (think car purchases) but also true to a lesser extent for the merchandise on this site (t-shirts, accessories, etc).</p>
<p>In the world of online marketing, identifying and marketing to these future customers based on the characteristics of their first visit will increase conversion rates and reduce the outflow to competitor sites.</p>
<h2 id="step4">Task 2. Select features and create your training dataset</h2>
<p>Now you will create a Machine Learning model in BigQuery to predict whether or not a new user is likely to purchase in the future. Identifying these high-value users can help your marketing team target them with special promotions and ad campaigns to ensure a conversion while they comparison shop between visits to your ecommerce site.</p>
<p>Google Analytics captures a wide variety of dimensions and measures about a user's visit on this ecommerce website. Browse the complete list of fields <a href="https://support.google.com/analytics/answer/3437719?hl=en" target="_blank">here</a> and then <a href="https://bigquery.cloud.google.com/table/data-to-insights:ecommerce.web_analytics?tab=preview" target="_blank">preview the demo dataset</a> to find useful features that will help a machine learning model understand the relationship between data about a visitor's first time on your website and whether they will return and make a purchase.</p>
<p>Your team decides to test whether these two fields are good inputs for your classification model:</p>
<ul>
<li>
<code>totals.bounces</code> (whether the visitor left the website immediately)</li>
<li>
<code>totals.timeOnSite</code> (how long the visitor was on our website)</li>
</ul>
<p><ql-multiple-choice-probe answerindex="2" optiontitles="[
&quot;Whether a user bounces is highly correlated with their time on site (e.g. 0 seconds) &quot;,
&quot;Only using time spent on the site ignores other potential useful columns (features)&quot;,
&quot;Both of the above&quot;                      
]" stem="What are the risks of only using the above two fields?">
</ql-multiple-choice-probe></p>
<p>Machine learning is only as good as the training data that is fed into it. If there isn't enough information for the model to determine and learn the relationship between your input features and your label (in this case, whether the visitor bought in the future) then you will not have an accurate model. While training a model on just these two fields is a start, you will see if they're good enough to produce an accurate model.</p>
<p>In the <strong>Query editor</strong>, add the following query and then click <strong>Run</strong>.</p>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">SELECT
  </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">fullVisitorId</span><span class="pun">)</span><span class="pln">
FROM

  </span><span class="com"># features</span><span class="pln">
  </span><span class="pun">(</span><span class="pln">SELECT
    fullVisitorId</span><span class="pun">,</span><span class="pln">
    IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
    IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site
  FROM
    </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  WHERE
    totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
  JOIN
  </span><span class="pun">(</span><span class="pln">SELECT
    fullvisitorid</span><span class="pun">,</span><span class="pln">
    IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM
      </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid</span><span class="pun">)</span><span class="pln">
  USING </span><span class="pun">(</span><span class="pln">fullVisitorId</span><span class="pun">)</span><span class="pln">
ORDER BY time_on_site DESC
LIMIT </span><span class="lit">10</span><span class="pun">;</span></code><button class="button button--text button--small copy-button js-copy-button-3"><ql-icon>content_copy</ql-icon></button></pre>
<p>Results:</p>
<table>

<tbody><tr>
<th>Row</th>
<th>bounces</th>
<th>time_on_site</th>
<th>will_buy_on_return_visit</th>
</tr>


<tr>
<td>1</td>
<td>0</td>
<td>15047</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>12136</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>11201</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>10046</td>
<td>0</td>
</tr>
<tr>
<td>5</td>
<td>0</td>
<td>9974</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>0</td>
<td>9564</td>
<td>0</td>
</tr>
<tr>
<td>7</td>
<td>0</td>
<td>9520</td>
<td>0</td>
</tr>
<tr>
<td>8</td>
<td>0</td>
<td>9275</td>
<td>1</td>
</tr>
<tr>
<td>9</td>
<td>0</td>
<td>9138</td>
<td>0</td>
</tr>
<tr>
<td>10</td>
<td>0</td>
<td>8872</td>
<td>0</td>
</tr>

</tbody></table>
<p><ql-multiple-choice-probe answerindex="0" optiontitles="[
&quot;The features are bounces and time_on_site. The label is will_buy_on_return_visit&quot;,
&quot;The feature is will_buy_on_return_visit. The labels are bounces and time_on_site&quot;,
&quot;The features are bounces and will_buy_on_return_visit. The label is time_on_site&quot;                      
]" shuffle="" stem="Which fields are the model features? What is the label (correct answer)?">
</ql-multiple-choice-probe></p>
<p><ql-multiple-select-probe answerindices="[0, 1, 2]" optiontitles="[
&quot;bounces&quot;,
&quot;time_on_site&quot;,
&quot;visitId&quot;,
&quot;will_buy_on_return_visit&quot;
]" shuffle="" stem="Which fields are known after a visitor&#39;s first session? (Check all that apply)">
</ql-multiple-select-probe></p>
<p><ql-multiple-select-probe answerindices="[3]" optiontitles="[
&quot;bounces&quot;,
&quot;time_on_site&quot;,
&quot;visitId&quot;,
&quot;will_buy_on_return_visit&quot;
]" shuffle="" stem="Which field isn&#39;t known until later in the future after their first session?">
</ql-multiple-select-probe></p>
<p><strong>Discussion:</strong> <strong>will_buy_on_return_visit</strong> is not known after the first visit. Again, you're predicting for a subset of users who returned to your website and purchased. Since you don't know the future at prediction time, you cannot say with certainty whether a new visitor comes back and purchases. The value of building a ML model is to get the probability of future purchase based on the data gleaned about their first session.</p>
<p><strong>Question:</strong> Looking at the initial data results, do you think <strong>time_on_site</strong> and <strong>bounces</strong> will be a good indicator of whether the user will return and purchase or not?</p>
<p><strong>Answer:</strong> It's often too early to tell before training and evaluating the model, but at first glance out of the top 10 <code>time_on_site</code>, only 1 customer returned to buy, which isn't very promising. Let's see how well the model does.</p>
<h2 id="step5">Task 3. Create a BigQuery dataset to store models</h2>
<p>Next, create a new BigQuery dataset which will also store your ML models.</p>
<ol>
<li>In the left pane, click on your project name, and then click on the <code>View action</code> icon (three dots) and select <strong>Create Dataset</strong>.</li>
</ol>
<p><img alt="BQ_Create_Dataset.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/MLruPrcRJ3W0w+PuZuslCVkTrrUjpZHoDY7Uml22LBI="></p>
<ol start="2">
<li>
<p>In the <strong>Create Dataset</strong> dialog:</p>
</li>
</ol>
<ul>
<li>
<p>For <strong>Dataset ID</strong>, type <strong>ecommerce</strong>.</p>
</li>
<li>
<p>Leave the other values at their defaults.</p>
</li>
</ul>
<ol start="3">
<li>Click <strong>Create dataset</strong>.</li>
</ol>

<h2 id="step6">Task 4. Select a BigQuery ML model type and specify options</h2>
<p>Now that you have your initial features selected, you are now ready to create your first ML model in BigQuery.</p>
<p>There are the two model types to choose from:</p>
<table>

<tbody><tr>
<th>Model</th>
<th>Model Type</th>
<th>Label Data type</th>
<th>Example</th>
</tr>


<tr>
<td>Forecasting</td>
<td>linear_reg</td>
<td>Numeric value (typically an integer or floating point)</td>
<td>Forecast sales figures for next year given historical sales data.</td>
</tr>
<tr>
<td>Classification</td>
<td>logistic_reg</td>
<td>0 or 1 for binary classification</td>
<td>Classify an email as spam or not spam given the context.</td>
</tr>

</tbody></table>
<p><strong>Note:</strong> There are many additional model types used in Machine Learning (like Neural Networks and decision trees) and available using libraries like <a href="https://www.tensorflow.org/tutorials/" target="_blank">TensorFlow</a>. At the time of writing, BigQuery ML supports the two listed above.</p>
<p><ql-multiple-choice-probe answerindex="0" optiontitles="[
&quot;Classification model (like logistic_reg etc.)&quot;,
&quot;Forecasting model (like linear_reg etc.)&quot;,
&quot;Recommendation model (like matrix_factorization etc.)&quot;                      
]" shuffle="" stem="Which model type should you choose that will buy or won&#39;t buy?">
</ql-multiple-choice-probe></p>
<ol>
<li>
<p>Enter the following query to create a model and specify model options:</p>
</li>
</ol>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">CREATE OR REPLACE MODEL </span><span class="str">`ecommerce.classification_model`</span><span class="pln">
OPTIONS
</span><span class="pun">(</span><span class="pln">
model_type</span><span class="pun">=</span><span class="str">'logistic_reg'</span><span class="pun">,</span><span class="pln">
labels </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'will_buy_on_return_visit'</span><span class="pun">]</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
AS

</span><span class="com">#standardSQL</span><span class="pln">
SELECT
  </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">fullVisitorId</span><span class="pun">)</span><span class="pln">
FROM

  </span><span class="com"># features</span><span class="pln">
  </span><span class="pun">(</span><span class="pln">SELECT
    fullVisitorId</span><span class="pun">,</span><span class="pln">
    IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
    IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site
  FROM
    </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  WHERE
    totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20160801'</span><span class="pln"> AND </span><span class="str">'20170430'</span><span class="pun">)</span><span class="pln"> </span><span class="com"># train on first 9 months</span><span class="pln">
  JOIN
  </span><span class="pun">(</span><span class="pln">SELECT
    fullvisitorid</span><span class="pun">,</span><span class="pln">
    IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM
      </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid</span><span class="pun">)</span><span class="pln">
  USING </span><span class="pun">(</span><span class="pln">fullVisitorId</span><span class="pun">)</span><span class="pln">
</span><span class="pun">;</span></code><button class="button button--text button--small copy-button js-copy-button-4"><ql-icon>content_copy</ql-icon></button></pre>
<ol start="2">
<li>Next, click <strong>Run</strong> to train your model.</li>
</ol>
<p>Wait for the model to train (5 - 10 minutes).</p>
<ql-infobox><strong>Note:</strong> You cannot feed all of your available data to the model during training since you need to save some unseen data points for model evaluation and testing. To accomplish this, add a WHERE clause condition is being used to filter and train on only the first 9 months of session data in your 12 month dataset.</ql-infobox>
<p>After your model is trained, you will see the message "This statement created a new model named qwiklabs-gcp-xxxxxxxxx:ecommerce.classification_model".</p>
<ol start="3">
<li>Click <strong>Go to model</strong>.</li>
</ol>
<p>Look inside the ecommerce dataset and confirm <strong>classification_model</strong> now appears.</p>
<p>Next, you will evaluate the performance of the model against new unseen evaluation data.</p>
<h2 id="step7">Task 5. Evaluate classification model performance</h2>
<h3>Select your performance criteria</h3>
<p>For classification problems in ML, you want to minimize the False Positive Rate (predict that the user will return and purchase and they don't) and maximize the True Positive Rate (predict that the user will return and purchase and they do).</p>
<p>This relationship is visualized with a ROC (Receiver Operating Characteristic) curve like the one shown here, where you try to maximize the area under the curve or AUC:</p>
<p><img alt="42fc12b6077e4784.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/GNW5Bw+8bviep9OK201QGPzaAEnKKyoIkDChUHeVdFw="></p>
<p>In BigQuery ML, <strong>roc_auc</strong> is simply a queryable field when evaluating your trained ML model.</p>
<p>Now that training is complete, you can evaluate how well the model performs by running this query using <code>ML.EVALUATE</code>:</p>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">SELECT
  roc_auc</span><span class="pun">,</span><span class="pln">
  CASE
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">9</span><span class="pln"> THEN </span><span class="str">'good'</span><span class="pln">
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pln"> THEN </span><span class="str">'fair'</span><span class="pln">
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">7</span><span class="pln"> THEN </span><span class="str">'not great'</span><span class="pln">
  ELSE </span><span class="str">'poor'</span><span class="pln"> </span><span class="kwd">END</span><span class="pln"> AS model_quality
FROM
  ML</span><span class="pun">.</span><span class="pln">EVALUATE</span><span class="pun">(</span><span class="pln">MODEL ecommerce</span><span class="pun">.</span><span class="pln">classification_model</span><span class="pun">,</span><span class="pln">  </span><span class="pun">(</span><span class="pln">

SELECT
  </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">fullVisitorId</span><span class="pun">)</span><span class="pln">
FROM

  </span><span class="com"># features</span><span class="pln">
  </span><span class="pun">(</span><span class="pln">SELECT
    fullVisitorId</span><span class="pun">,</span><span class="pln">
    IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
    IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site
  FROM
    </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  WHERE
    totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20170501'</span><span class="pln"> AND </span><span class="str">'20170630'</span><span class="pun">)</span><span class="pln"> </span><span class="com"># eval on 2 months</span><span class="pln">
  JOIN
  </span><span class="pun">(</span><span class="pln">SELECT
    fullvisitorid</span><span class="pun">,</span><span class="pln">
    IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM
      </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid</span><span class="pun">)</span><span class="pln">
  USING </span><span class="pun">(</span><span class="pln">fullVisitorId</span><span class="pun">)</span><span class="pln">

</span><span class="pun">));</span></code><button class="button button--text button--small copy-button js-copy-button-5"><ql-icon>content_copy</ql-icon></button></pre>
<p>You should see the following result:</p>
<table>

<tbody><tr>
<th>Row</th>
<th>roc_auc</th>
<th>model_quality</th>
</tr>


<tr>
<td>1</td>
<td>0.724588</td>
<td>not great</td>
</tr>

</tbody></table>
<p>After evaluating your model you get a <strong>roc_auc</strong> of 0.72, which shows that the model has not great predictive power. Since the goal is to get the area under the curve as close to 1.0 as possible, there is room for improvement.</p>

<h2 id="step8">Task 6. Improve model performance with feature engineering</h2>
<p>As was hinted at earlier, there are many more features in the dataset that may help the model better understand the relationship between a visitor's first session and the likelihood that they will purchase on a subsequent visit.</p>
<p>Add some new features and create a second machine learning model called <code>classification_model_2</code>:</p>
<ul>
<li>
<p>How far the visitor got in the checkout process on their first visit</p>
</li>
<li>
<p>Where the visitor came from (traffic source: organic search, referring site etc.)</p>
</li>
<li>
<p>Device category (mobile, tablet, desktop)</p>
</li>
<li>
<p>Geographic information (country)</p>
</li>
</ul>
<ol>
<li>
<p>Create this second model by running the below query:</p>
</li>
</ol>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">CREATE OR REPLACE MODEL </span><span class="str">`ecommerce.classification_model_2`</span><span class="pln">
OPTIONS
  </span><span class="pun">(</span><span class="pln">model_type</span><span class="pun">=</span><span class="str">'logistic_reg'</span><span class="pun">,</span><span class="pln"> labels </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'will_buy_on_return_visit'</span><span class="pun">])</span><span class="pln"> AS

WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
SELECT
  fullvisitorid</span><span class="pun">,</span><span class="pln">
  IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid
</span><span class="pun">)</span><span class="pln">

</span><span class="com"># add in new features</span><span class="pln">
SELECT </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">unique_session_id</span><span class="pun">)</span><span class="pln"> FROM </span><span class="pun">(</span><span class="pln">

  SELECT
      CONCAT</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">,</span><span class="pln"> CAST</span><span class="pun">(</span><span class="pln">visitId AS STRING</span><span class="pun">))</span><span class="pln"> AS unique_session_id</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># labels</span><span class="pln">
      will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">

      MAX</span><span class="pun">(</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">eCommerceAction</span><span class="pun">.</span><span class="pln">action_type AS INT64</span><span class="pun">))</span><span class="pln"> AS latest_ecommerce_progress</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># behavior on the site</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site</span><span class="pun">,</span><span class="pln">
      totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># where the visitor came from</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
      channelGrouping</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># mobile or desktop</span><span class="pln">
      device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># geographic</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">geoNetwork</span><span class="pun">.</span><span class="pln">country</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> AS country

  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
     UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h

    JOIN all_visitor_stats USING</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">)</span><span class="pln">

  WHERE </span><span class="lit">1</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
    </span><span class="com"># only predict for new visits</span><span class="pln">
    AND totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20160801'</span><span class="pln"> AND </span><span class="str">'20170430'</span><span class="pln"> </span><span class="com"># train 9 months</span><span class="pln">

  GROUP BY
  unique_session_id</span><span class="pun">,</span><span class="pln">
  will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">
  bounces</span><span class="pun">,</span><span class="pln">
  time_on_site</span><span class="pun">,</span><span class="pln">
  totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
  channelGrouping</span><span class="pun">,</span><span class="pln">
  device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">
  country
</span><span class="pun">);</span></code><button class="button button--text button--small copy-button js-copy-button-6"><ql-icon>content_copy</ql-icon></button></pre>
<ql-infobox>
<strong>Note:</strong> You are still training on the same first 9 months of data, even with this new model. It's important to have the same training dataset so you can be certain a better model output is attributable to better input features and not new or different training data.
</ql-infobox>
<p>A key new feature that was added to the training dataset query is the maximum checkout progress each visitor reached in their session, which is recorded in the field <code>hits.eCommerceAction.action_type</code>. If you search for that field in the <a href="https://support.google.com/analytics/answer/3437719?hl=en" target="_blank">field definitions</a> you will see the field mapping of 6 = Completed Purchase.</p>
<p>As an aside, the web analytics dataset has nested and repeated fields like <a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/arrays" target="_blank">ARRAYS</a> which need to be broken apart into separate rows in your dataset. This is accomplished by using the UNNEST() function, which you can see in the above query.</p>
<p>Wait for the new model to finish training (5-10 minutes).</p>

<ol start="2">
<li>
<p>Evaluate this new model to see if there is better predictive power by running the below query:</p>
</li>
</ol>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="com">#standardSQL</span><span class="pln">
SELECT
  roc_auc</span><span class="pun">,</span><span class="pln">
  CASE
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">9</span><span class="pln"> THEN </span><span class="str">'good'</span><span class="pln">
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pln"> THEN </span><span class="str">'fair'</span><span class="pln">
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">7</span><span class="pln"> THEN </span><span class="str">'not great'</span><span class="pln">
  ELSE </span><span class="str">'poor'</span><span class="pln"> </span><span class="kwd">END</span><span class="pln"> AS model_quality
FROM
  ML</span><span class="pun">.</span><span class="pln">EVALUATE</span><span class="pun">(</span><span class="pln">MODEL ecommerce</span><span class="pun">.</span><span class="pln">classification_model_2</span><span class="pun">,</span><span class="pln">  </span><span class="pun">(</span><span class="pln">

WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
SELECT
  fullvisitorid</span><span class="pun">,</span><span class="pln">
  IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid
</span><span class="pun">)</span><span class="pln">

</span><span class="com"># add in new features</span><span class="pln">
SELECT </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">unique_session_id</span><span class="pun">)</span><span class="pln"> FROM </span><span class="pun">(</span><span class="pln">

  SELECT
      CONCAT</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">,</span><span class="pln"> CAST</span><span class="pun">(</span><span class="pln">visitId AS STRING</span><span class="pun">))</span><span class="pln"> AS unique_session_id</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># labels</span><span class="pln">
      will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">

      MAX</span><span class="pun">(</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">eCommerceAction</span><span class="pun">.</span><span class="pln">action_type AS INT64</span><span class="pun">))</span><span class="pln"> AS latest_ecommerce_progress</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># behavior on the site</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site</span><span class="pun">,</span><span class="pln">
      totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># where the visitor came from</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
      channelGrouping</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># mobile or desktop</span><span class="pln">
      device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># geographic</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">geoNetwork</span><span class="pun">.</span><span class="pln">country</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> AS country

  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
     UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h

    JOIN all_visitor_stats USING</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">)</span><span class="pln">

  WHERE </span><span class="lit">1</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
    </span><span class="com"># only predict for new visits</span><span class="pln">
    AND totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20170501'</span><span class="pln"> AND </span><span class="str">'20170630'</span><span class="pln"> </span><span class="com"># eval 2 months</span><span class="pln">

  GROUP BY
  unique_session_id</span><span class="pun">,</span><span class="pln">
  will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">
  bounces</span><span class="pun">,</span><span class="pln">
  time_on_site</span><span class="pun">,</span><span class="pln">
  totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
  channelGrouping</span><span class="pun">,</span><span class="pln">
  device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">
  country
</span><span class="pun">)</span><span class="pln">
</span><span class="pun">));</span></code><button class="button button--text button--small copy-button js-copy-button-7"><ql-icon>content_copy</ql-icon></button></pre>
<p>(Output)</p>
<table>

<tbody><tr>
<th>Row</th>
<th>roc_auc</th>
<th>model_quality</th>
</tr>


<tr>
<td>1</td>
<td>0.910382</td>
<td>good</td>
</tr>

</tbody></table>
<p>With this new model you now get a <strong>roc_auc</strong> of 0.91 which is significantly better than the first model.</p>
<p>Now that you have a trained model, time to make some predictions.</p>

<h2 id="step9">Task 7. Predict which new visitors will come back and purchase</h2>
<p>Next you will write a query to predict which new visitors will come back and make a purchase.</p>
<p>Run the prediction query below which uses the improved classification model to predict the probability that a first-time visitor to the Google Merchandise Store will make a purchase in a later visit:</p>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">SELECT
</span><span class="pun">*</span><span class="pln">
FROM
  ml</span><span class="pun">.</span><span class="pln">PREDICT</span><span class="pun">(</span><span class="pln">MODEL </span><span class="str">`ecommerce.classification_model_2`</span><span class="pun">,</span><span class="pln">
   </span><span class="pun">(</span><span class="pln">

WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
SELECT
  fullvisitorid</span><span class="pun">,</span><span class="pln">
  IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid
</span><span class="pun">)</span><span class="pln">

  SELECT
      CONCAT</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">,</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">visitId AS STRING</span><span class="pun">))</span><span class="pln"> AS unique_session_id</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># labels</span><span class="pln">
      will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">

      MAX</span><span class="pun">(</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">eCommerceAction</span><span class="pun">.</span><span class="pln">action_type AS INT64</span><span class="pun">))</span><span class="pln"> AS latest_ecommerce_progress</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># behavior on the site</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site</span><span class="pun">,</span><span class="pln">
      totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># where the visitor came from</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
      channelGrouping</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># mobile or desktop</span><span class="pln">
      device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># geographic</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">geoNetwork</span><span class="pun">.</span><span class="pln">country</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> AS country

  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
     UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h

    JOIN all_visitor_stats USING</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">)</span><span class="pln">

  WHERE
    </span><span class="com"># only predict for new visits</span><span class="pln">
    totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20170701'</span><span class="pln"> AND </span><span class="str">'20170801'</span><span class="pln"> </span><span class="com"># test 1 month</span><span class="pln">

  GROUP BY
  unique_session_id</span><span class="pun">,</span><span class="pln">
  will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">
  bounces</span><span class="pun">,</span><span class="pln">
  time_on_site</span><span class="pun">,</span><span class="pln">
  totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
  channelGrouping</span><span class="pun">,</span><span class="pln">
  device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">
  country
</span><span class="pun">)</span><span class="pln">

</span><span class="pun">)</span><span class="pln">

ORDER BY
  predicted_will_buy_on_return_visit DESC</span><span class="pun">;</span></code><button class="button button--text button--small copy-button js-copy-button-8"><ql-icon>content_copy</ql-icon></button></pre>
<p>The predictions are made in the last 1 month (out of 12 months) of the dataset.</p>

<p>Your model will now output the predictions it has for those July 2017 ecommerce sessions. You can see three newly added fields:</p>
<ul>
<li>predicted_will_buy_on_return_visit: whether the model thinks the visitor will buy later (1 = yes)</li>
<li>predicted_will_buy_on_return_visit_probs.label: the binary classifier for yes / no</li>
<li>predicted_will_buy_on_return_visit_probs.prob: the confidence the model has in it's prediction (1 = 100%)</li>
</ul>
<p><img alt="710c0c0b9abf827b.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/fEttKDSQAqoD3sZWAo04MVkXGfM+yRDnOQST_aCRZwg="></p>
<h2 id="step10">Results</h2>
<ul>
<li>
<p>Of the top 6% of first-time visitors (sorted in decreasing order of predicted probability), more than 6% make a purchase in a later visit.</p>
</li>
<li>
<p>These users represent nearly 50% of all first-time visitors who make a purchase in a later visit.</p>
</li>
<li>
<p>Overall, only 0.7% of first-time visitors make a purchase in a later visit.</p>
</li>
<li>
<p>Targeting the top 6% of first-time increases marketing ROI by 9x vs targeting them all!</p>
</li>
</ul>
<h3>Additional information</h3>
<p><strong>roc_auc</strong> is just one of the performance metrics available during model evaluation. Also available are <a href="https://en.wikipedia.org/wiki/Precision_and_recall" target="_blank">accuracy, precision, and recall</a>. Knowing which performance metric to rely on is highly dependent on what your overall objective or goal is.</p>
<h3>Congratulations!</h3>
<p>You created a machine learning model using just SQL.</p>
<h2 id="step11">Challenge</h2>
<h3>Summary</h3>
<p>In the previous two tasks you saw the power of feature engineering at work in improving our models performance. However, we still may be able to improve our performance by exploring other model types.  For classification problems, BigQuery ML also supports the following model types:</p>
<ul>
<li>
<p><a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-dnn-models" target="_blank">Deep Neural Networks .</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-boosted-tree" target="_blank">Boosted Decision Trees (XGBoost) .</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-automl" target="_blank">AutoML Tables Models .</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow" target="_blank">Importing Custom TensorFlow Models .</a></p>
</li>
</ul>
<h3>Task</h3>
<p>Though our linear classification (logistic regression) model performed well after feature engineering, it may be too simple of a model to fully capture the relationship between the features and the label. Using the same dataset and labels as you did in Task 6 to create the model ecommerce.classification_model_2, your challenge is to create a XGBoost Classifier.</p>
<ql-infobox>
<strong>Hint :</strong> Use following options for Boosted_Tree_Classifier:
<div>1. L2_reg = 0.1</div>
<div>2. num_parallel_tree = 8</div>
<div>3. max_tree_depth = 10</div>
</ql-infobox>
<p>You may need to look at the documentation linked above to see the exact syntax. The model will take around 7 minutes to train. The solution can be found in the solution section below if you need help writing the query.</p>
<h3>Solution:</h3>
<p>This is the solution that you require in order to create a XGBoost Classifier.</p>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">CREATE OR REPLACE MODEL </span><span class="str">`ecommerce.classification_model_3`</span><span class="pln">
        OPTIONS
          </span><span class="pun">(</span><span class="pln">model_type</span><span class="pun">=</span><span class="str">'BOOSTED_TREE_CLASSIFIER'</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> l2_reg </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">,</span><span class="pln"> num_parallel_tree </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> max_tree_depth </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln">
              labels </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'will_buy_on_return_visit'</span><span class="pun">])</span><span class="pln"> AS

        WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
        SELECT
          fullvisitorid</span><span class="pun">,</span><span class="pln">
          IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
          FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
          GROUP BY fullvisitorid
        </span><span class="pun">)</span><span class="pln">

        </span><span class="com"># add in new features</span><span class="pln">
        SELECT </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">unique_session_id</span><span class="pun">)</span><span class="pln"> FROM </span><span class="pun">(</span><span class="pln">

          SELECT
              CONCAT</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">,</span><span class="pln"> CAST</span><span class="pun">(</span><span class="pln">visitId AS STRING</span><span class="pun">))</span><span class="pln"> AS unique_session_id</span><span class="pun">,</span><span class="pln">

              </span><span class="com"># labels</span><span class="pln">
              will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">

              MAX</span><span class="pun">(</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">eCommerceAction</span><span class="pun">.</span><span class="pln">action_type AS INT64</span><span class="pun">))</span><span class="pln"> AS latest_ecommerce_progress</span><span class="pun">,</span><span class="pln">

              </span><span class="com"># behavior on the site</span><span class="pln">
              IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
              IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site</span><span class="pun">,</span><span class="pln">
              totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">

              </span><span class="com"># where the visitor came from</span><span class="pln">
              trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
              trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
              channelGrouping</span><span class="pun">,</span><span class="pln">

              </span><span class="com"># mobile or desktop</span><span class="pln">
              device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">

              </span><span class="com"># geographic</span><span class="pln">
              IFNULL</span><span class="pun">(</span><span class="pln">geoNetwork</span><span class="pun">.</span><span class="pln">country</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> AS country

          FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
             UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h

            JOIN all_visitor_stats USING</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">)</span><span class="pln">

          WHERE </span><span class="lit">1</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
            </span><span class="com"># only predict for new visits</span><span class="pln">
            AND totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
            AND date BETWEEN </span><span class="str">'20160801'</span><span class="pln"> AND </span><span class="str">'20170430'</span><span class="pln"> </span><span class="com"># train 9 months</span><span class="pln">

          GROUP BY
          unique_session_id</span><span class="pun">,</span><span class="pln">
          will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">
          bounces</span><span class="pun">,</span><span class="pln">
          time_on_site</span><span class="pun">,</span><span class="pln">
          totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">
          trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
          trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
          channelGrouping</span><span class="pun">,</span><span class="pln">
          device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">
          country
        </span><span class="pun">);</span></code><button class="button button--text button--small copy-button js-copy-button-9"><ql-icon>content_copy</ql-icon></button></pre>
<p>Let us now evaluate our model and see how we did.</p>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="com">#standardSQL</span><span class="pln">
SELECT
  roc_auc</span><span class="pun">,</span><span class="pln">
  CASE
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">9</span><span class="pln"> THEN </span><span class="str">'good'</span><span class="pln">
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pln"> THEN </span><span class="str">'fair'</span><span class="pln">
    WHEN roc_auc </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">.</span><span class="lit">7</span><span class="pln"> THEN </span><span class="str">'not great'</span><span class="pln">
  ELSE </span><span class="str">'poor'</span><span class="pln"> </span><span class="kwd">END</span><span class="pln"> AS model_quality
FROM
  ML</span><span class="pun">.</span><span class="pln">EVALUATE</span><span class="pun">(</span><span class="pln">MODEL ecommerce</span><span class="pun">.</span><span class="pln">classification_model_3</span><span class="pun">,</span><span class="pln">  </span><span class="pun">(</span><span class="pln">

WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
SELECT
  fullvisitorid</span><span class="pun">,</span><span class="pln">
  IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid
</span><span class="pun">)</span><span class="pln">

</span><span class="com"># add in new features</span><span class="pln">
SELECT </span><span class="pun">*</span><span class="pln"> EXCEPT</span><span class="pun">(</span><span class="pln">unique_session_id</span><span class="pun">)</span><span class="pln"> FROM </span><span class="pun">(</span><span class="pln">

  SELECT
      CONCAT</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">,</span><span class="pln"> CAST</span><span class="pun">(</span><span class="pln">visitId AS STRING</span><span class="pun">))</span><span class="pln"> AS unique_session_id</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># labels</span><span class="pln">
      will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">

      MAX</span><span class="pun">(</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">eCommerceAction</span><span class="pun">.</span><span class="pln">action_type AS INT64</span><span class="pun">))</span><span class="pln"> AS latest_ecommerce_progress</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># behavior on the site</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site</span><span class="pun">,</span><span class="pln">
      totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># where the visitor came from</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
      channelGrouping</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># mobile or desktop</span><span class="pln">
      device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># geographic</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">geoNetwork</span><span class="pun">.</span><span class="pln">country</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> AS country

  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
     UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h

    JOIN all_visitor_stats USING</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">)</span><span class="pln">

  WHERE </span><span class="lit">1</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
    </span><span class="com"># only predict for new visits</span><span class="pln">
    AND totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20170501'</span><span class="pln"> AND </span><span class="str">'20170630'</span><span class="pln"> </span><span class="com"># eval 2 months</span><span class="pln">

  GROUP BY
  unique_session_id</span><span class="pun">,</span><span class="pln">
  will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">
  bounces</span><span class="pun">,</span><span class="pln">
  time_on_site</span><span class="pun">,</span><span class="pln">
  totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
  channelGrouping</span><span class="pun">,</span><span class="pln">
  device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">
  country
</span><span class="pun">)</span><span class="pln">
</span><span class="pun">));</span></code><button class="button button--text button--small copy-button js-copy-button-10"><ql-icon>content_copy</ql-icon></button></pre>
<p>Our roc_auc has increased by about .02 to around .94!</p>
<ql-infobox>
<strong>Note :</strong> Your exact values will differ due to the randomness involved in the training process.
</ql-infobox>
<p>It’s a small change in the roc_auc, but note that since 1 is a perfect roc_auc, it gets more difficult to improve the metric the closer to 1 it gets.</p>
<p>This is a great example of how easy it is in BigQuery ML to try out different model types with different options to see how they perform. We were able to use a much more complex model type by only changing one line of SQL.</p>
<p>One may reasonably ask “Where did the choices for these options come from?”, and the answer is experimentation! When you are trying to find the best model type for your problems, then one has to experiment with different sets of options in a process known as hyperparameter tuning.</p>
<p>Let’s finish up by generating predictions with our improved model and see how they compare to those we generated before. By using a <strong>Boosted tree classifier model</strong>, you can observe a slight improvement of 0.2 in our ROC AUC compared to the previous model. The query below will predict which new visitors will come back and make a purchase.</p>
<pre><code class="language-sql prettyprint prettyprinted" style=""><span class="pln">SELECT
</span><span class="pun">*</span><span class="pln">
FROM
  ml</span><span class="pun">.</span><span class="pln">PREDICT</span><span class="pun">(</span><span class="pln">MODEL </span><span class="str">`ecommerce.classification_model_3`</span><span class="pun">,</span><span class="pln">
   </span><span class="pun">(</span><span class="pln">

WITH all_visitor_stats AS </span><span class="pun">(</span><span class="pln">
SELECT
  fullvisitorid</span><span class="pun">,</span><span class="pln">
  IF</span><span class="pun">(</span><span class="pln">COUNTIF</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">transactions </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> AND totals</span><span class="pun">.</span><span class="pln">newVisits IS NULL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS will_buy_on_return_visit
  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pln">
  GROUP BY fullvisitorid
</span><span class="pun">)</span><span class="pln">

  SELECT
      CONCAT</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">,</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">visitId AS STRING</span><span class="pun">))</span><span class="pln"> AS unique_session_id</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># labels</span><span class="pln">
      will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">

      MAX</span><span class="pun">(</span><span class="pln">CAST</span><span class="pun">(</span><span class="pln">h</span><span class="pun">.</span><span class="pln">eCommerceAction</span><span class="pun">.</span><span class="pln">action_type AS INT64</span><span class="pun">))</span><span class="pln"> AS latest_ecommerce_progress</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># behavior on the site</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">bounces</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS bounces</span><span class="pun">,</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">totals</span><span class="pun">.</span><span class="pln">timeOnSite</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> AS time_on_site</span><span class="pun">,</span><span class="pln">
      totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># where the visitor came from</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
      trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
      channelGrouping</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># mobile or desktop</span><span class="pln">
      device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">

      </span><span class="com"># geographic</span><span class="pln">
      IFNULL</span><span class="pun">(</span><span class="pln">geoNetwork</span><span class="pun">.</span><span class="pln">country</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln"> AS country

  FROM </span><span class="str">`data-to-insights.ecommerce.web_analytics`</span><span class="pun">,</span><span class="pln">
     UNNEST</span><span class="pun">(</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> AS h

    JOIN all_visitor_stats USING</span><span class="pun">(</span><span class="pln">fullvisitorid</span><span class="pun">)</span><span class="pln">

  WHERE
    </span><span class="com"># only predict for new visits</span><span class="pln">
    totals</span><span class="pun">.</span><span class="pln">newVisits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    AND date BETWEEN </span><span class="str">'20170701'</span><span class="pln"> AND </span><span class="str">'20170801'</span><span class="pln"> </span><span class="com"># test 1 month</span><span class="pln">

  GROUP BY
  unique_session_id</span><span class="pun">,</span><span class="pln">
  will_buy_on_return_visit</span><span class="pun">,</span><span class="pln">
  bounces</span><span class="pun">,</span><span class="pln">
  time_on_site</span><span class="pun">,</span><span class="pln">
  totals</span><span class="pun">.</span><span class="pln">pageviews</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">source</span><span class="pun">,</span><span class="pln">
  trafficSource</span><span class="pun">.</span><span class="pln">medium</span><span class="pun">,</span><span class="pln">
  channelGrouping</span><span class="pun">,</span><span class="pln">
  device</span><span class="pun">.</span><span class="pln">deviceCategory</span><span class="pun">,</span><span class="pln">
  country
</span><span class="pun">)</span><span class="pln">

</span><span class="pun">)</span><span class="pln">

ORDER BY
  predicted_will_buy_on_return_visit DESC</span><span class="pun">;</span></code><button class="button button--text button--small copy-button js-copy-button-11"><ql-icon>content_copy</ql-icon></button></pre>
<p><img alt="boostedtree.png" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/WvqgXVOr5x9sPFf7Eq723o29RBZ0GUGAz059_8vpSqI="></p>
<p>The output now shows a classification model that can better predict the probability that a first-time visitor to the Google Merchandise Store will make a purchase in a later visit.
By comparing the result above with the previous model shown in Task 7, you can see the confidence the model has in its predictions is more accurate when compared to the logistic_regression model type.</p>
<h2 id="step12">End your lab</h2>
<p>When you have completed your lab, click <strong>End Lab</strong>. Qwiklabs removes the resources you’ve used and cleans the account for you.</p>
<p>You will be given an opportunity to rate the lab experience. Select the applicable number of stars, type a comment, and then click <strong>Submit</strong>.</p>
<p>The number of stars indicates the following:</p>
<ul>
<li>1 star = Very dissatisfied</li>
<li>2 stars = Dissatisfied</li>
<li>3 stars = Neutral</li>
<li>4 stars = Satisfied</li>
<li>5 stars = Very satisfied</li>
</ul>
<p>You can close the dialog box if you don't want to provide feedback.</p>
<p>For feedback, suggestions, or corrections, please use the <strong>Support</strong> tab.</p>

<p>Copyright 2021 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>



</div>
</div>


<div class="hidden js-end-lab-button-container lab-content__end-lab-button">
<ql-lab-control-button class="js-end-lab-button" running=""></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
</ql-drawer-content>
<ql-drawer end="" id="outline-drawer" open="" slot="drawer" width="320" style="width: 320px;">
<div class="js-lab-content-outline lab-content__outline">
<a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step1">Overview</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step2">Set up your environments</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step3">Task 1. Explore ecommerce data</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step4">Task 2. Select features and create your training dataset</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step5">Task 3. Create a BigQuery dataset to store models</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step6">Task 4. Select a BigQuery ML model type and specify options</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step7">Task 5. Evaluate classification model performance</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step8">Task 6. Improve model performance with feature engineering</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step9">Task 7. Predict which new visitors will come back and purchase</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step10">Results</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step11">Challenge</a><a href="https://googlecoursera.qwiklabs.com/focuses/16187033?parent=lti_session#step12">End your lab</a>
</div>
</ql-drawer>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<div class="lab-introduction js-lab-introduction is-hidden">
<div class="lab-introduction__inner">
<h1 class="headline-1">Welcome to Your First Lab!</h1>
<ql-icon-button class="js-skip-button">close</ql-icon-button>
<div class="lab-introduction__video">
<iframe allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0" id="lab-introduction" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/yF7EDXKTmoQ.html" data-gtm-yt-inspected-1_25="true"></iframe>
</div>
<a class="js-skip-button button button--outline">Skip this video</a>
</div>
</div>



</div>
</main>


<div class="modal fade" id="lab-details-modal">
<div class="modal-container">
<div class="mdl-shadow--24dp modal-content">
<div class="modal-body">
<p class="l-mbm">
Want to build ML models with just SQL? Learn how with BigQuery ML on this Google Analytics ecommerce dataset
</p>
<p class="small-label l-mbs">
<strong>
Duration:
</strong>
0m setup
·
80m access
·
70m completion
</p>
<p class="small-label l-mbs">
<span><strong>Levels: </strong>introductory</span>
</p>
<p class="small-label">
<strong>
Permalink:
</strong>
<a href="https://googlecoursera.qwiklabs.com/catalog_lab/1795">https://googlecoursera.qwiklabs.com/catalog_lab/1795</a>
</p>
</div>
<div class="modal-actions">
<a class="button button--text" data-dismiss="modal">
Got It
</a>
</div>


</div>
</div>
<iframe class="l-ie-iframe-fix" __idm_frm__="640" data-gtm-yt-inspected-1_25="true" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(4).html"></iframe>
</div>
<div class="modal fade" id="lab-review-modal">
<div class="modal-container">
<div class="mdl-shadow--24dp modal-content">
<form class="simple_form js-lab-review-form" id="edit_lab_review_12999765" action="https://googlecoursera.qwiklabs.com/lab_reviews/12999765" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="_method" value="patch"><div class="modal-body">
<p class="label">
How satisfied are you with this lab?*
</p>
<div class="rateit js-rateit" data-rateit-max="5" data-rateit-min="0" data-rateit-resetable="false" data-rateit-step="1" data-rateit-value="5"><div class="rateit-reset" style="display: none;"></div><div class="rateit-range" style="width: 80px; height: 16px;"><div class="rateit-selected" style="height: 16px; width: 80px;"></div><div class="rateit-hover" style="height:16px"></div></div></div>
<div class="l-mtm">

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="5037645" name="lab_review[user_id]" id="lab_review_user_id"></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id"></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="1795" name="lab_review[lab_id]" id="lab_review_lab_id"></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id"></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" value="2" name="lab_review[rating]" id="lab_review_rating"></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment"></textarea></div></div>
</div>
</div>
<div class="modal-actions">
<a class="button button--text" data-dismiss="modal">
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" id="submit" data-disabled="false" class="button" data-disable-with="Submit">
</div>
</form>

</div>
</div>
<iframe class="l-ie-iframe-fix" __idm_frm__="641" data-gtm-yt-inspected-1_25="true" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(5).html"></iframe>
</div>


<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.chat.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>




<div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s ease 0s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><iframe title="reCAPTCHA" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/anchor(2).html" width="256" height="60" role="presentation" name="a-b63zkt8ofsip" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox" data-gtm-yt-inspected-1_25="true"></iframe></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div></div><iframe data-product="web_widget" title="No content" tabindex="-1" aria-hidden="true" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(6).html" __idm_frm__="646" data-gtm-yt-inspected-1_25="true" style="width: 0px; height: 0px; border: 0px; position: absolute; top: -9999px;"></iframe><div><iframe title="Opens a widget where you can chat to one of our agents" id="launcher" tabindex="-1" data-gtm-yt-inspected-1_25="true" __idm_frm__="648" style="width: 107px; height: 50px; padding: 0px; margin: 10px 20px; position: fixed; bottom: 30px; overflow: visible; opacity: 0; border: 0px; z-index: 999998; transition-duration: 250ms; transition-timing-function: cubic-bezier(0.645, 0.045, 0.355, 1); transition-property: opacity, top, bottom; top: -9999px; visibility: hidden;" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/saved_resource(7).html"></iframe></div><div style="background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); box-shadow: rgba(0, 0, 0, 0.2) 2px 2px 3px; position: absolute; transition: visibility 0s linear 0.3s, opacity 0.3s linear 0s; opacity: 0; visibility: hidden; z-index: 2000000000; left: 0px; top: -10000px;"><div style="width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; z-index: 2000000000; background-color: rgb(255, 255, 255); opacity: 0.05;"></div><div class="g-recaptcha-bubble-arrow" style="border: 11px solid transparent; width: 0px; height: 0px; position: absolute; pointer-events: none; margin-top: -11px; z-index: 2000000000;"></div><div class="g-recaptcha-bubble-arrow" style="border: 10px solid transparent; width: 0px; height: 0px; position: absolute; pointer-events: none; margin-top: -10px; z-index: 2000000000;"></div><div style="z-index: 2000000000; position: relative;"><iframe title="recaptcha challenge" src="./Predicting Visitor Purchases with a Classification Model with BigQuery ML _ Qwiklabs_files/bframe.html" name="c-b13dm2x5wcd9" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox" style="width: 100%; height: 100%;" data-gtm-yt-inspected-1_25="true"></iframe></div></div></body></html>